<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Multi Tools — MC Bedrock</title>
<link href="https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&family=Bebas+Neue&family=DM+Sans:wght@300;400;500;600&display=swap" rel="stylesheet">
<style>
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
:root{--bg:#f5f4f0;--white:#fff;--border:#e2e0d8;--border2:#ccc9be;--text:#17160f;--muted:#8a8678;--red:#e63b1e;--red-dark:#c42e14;--green:#19a060;--code-bg:#19180f;--code-text:#e8e2d0;--radius:16px;--radius-sm:10px;--shadow:0 1px 4px rgba(0,0,0,.06),0 0 0 1.5px var(--border)}
html{scroll-behavior:smooth}
body{font-family:'DM Sans',sans-serif;background:var(--bg);color:var(--text);min-height:100vh;overflow-x:hidden}
body::before{content:'';position:fixed;inset:0;background-image:linear-gradient(rgba(0,0,0,.03) 1px,transparent 1px),linear-gradient(90deg,rgba(0,0,0,.03) 1px,transparent 1px);background-size:28px 28px;pointer-events:none;z-index:0}
header{position:relative;z-index:10;padding:52px 24px 0;text-align:center}
.badge{display:inline-flex;align-items:center;gap:8px;background:var(--code-bg);color:#c8c0a8;padding:5px 14px 5px 10px;border-radius:100px;font-family:'Space Mono',monospace;font-size:10px;letter-spacing:.06em;margin-bottom:24px;animation:fadeD .5s ease both}
.badge .blink{width:7px;height:7px;background:var(--red);border-radius:2px;animation:blink 1.6s infinite}
@keyframes blink{0%,100%{opacity:1}50%{opacity:.2}}
h1{font-family:'Bebas Neue',cursive;font-size:clamp(64px,14vw,120px);line-height:.92;letter-spacing:.01em;color:var(--text);animation:fadeD .55s .08s ease both}
h1 em{color:var(--red);font-style:normal}
.tagline{font-size:13px;color:var(--muted);letter-spacing:.03em;margin-top:12px;animation:fadeD .55s .15s ease both}
.lang-row{display:flex;gap:6px;justify-content:center;margin-top:22px;animation:fadeD .55s .22s ease both}
.lang-btn{font-family:'Space Mono',monospace;font-size:10px;font-weight:700;letter-spacing:.06em;padding:5px 14px;border-radius:100px;border:1.5px solid var(--border2);background:var(--white);cursor:pointer;transition:all .2s}
.lang-btn:hover,.lang-btn.on{background:var(--text);color:#fff;border-color:var(--text)}
.nav-bar{position:sticky;top:0;z-index:100;background:rgba(245,244,240,.92);backdrop-filter:blur(12px);border-bottom:1.5px solid var(--border);padding:10px 20px;display:flex;gap:6px;overflow-x:auto;scrollbar-width:none;margin-top:36px}
.nav-bar::-webkit-scrollbar{display:none}
.nav-pill{flex-shrink:0;font-family:'Space Mono',monospace;font-size:10px;letter-spacing:.04em;padding:6px 14px;border-radius:100px;border:1.5px solid var(--border);background:var(--white);cursor:pointer;transition:all .18s;color:var(--text);text-decoration:none;white-space:nowrap}
.nav-pill:hover{background:var(--red);color:#fff;border-color:var(--red)}
main{position:relative;z-index:5;max-width:860px;margin:32px auto 80px;padding:0 16px;display:flex;flex-direction:column;gap:12px}
.card{background:var(--white);border:1.5px solid var(--border);border-radius:var(--radius);box-shadow:var(--shadow);overflow:hidden;transition:box-shadow .25s,border-color .25s;animation:fadeU .5s ease both}
.card:hover{box-shadow:0 6px 24px rgba(0,0,0,.08)}
.card.open{border-color:var(--red)}
.card:nth-child(1){animation-delay:.1s}.card:nth-child(2){animation-delay:.15s}.card:nth-child(3){animation-delay:.2s}.card:nth-child(4){animation-delay:.25s}.card:nth-child(5){animation-delay:.3s}.card:nth-child(6){animation-delay:.35s}.card:nth-child(7){animation-delay:.4s}
.card-head{display:flex;align-items:center;gap:14px;padding:16px 20px;cursor:pointer;user-select:none;transition:background .2s}
.card-head:hover{background:var(--bg)}
.icon-box{width:40px;height:40px;border-radius:11px;display:flex;align-items:center;justify-content:center;font-size:18px;flex-shrink:0;border:1.5px solid var(--border)}
.card-meta{flex:1}
.card-name{font-family:'Bebas Neue',cursive;font-size:20px;letter-spacing:.04em;line-height:1}
.card-sub{font-size:11.5px;color:var(--muted);margin-top:2px}
.chevron{color:var(--muted);font-size:20px;transition:transform .3s;line-height:1}
.card.open .chevron{transform:rotate(180deg);color:var(--red)}
.card-body{display:none;padding:18px 20px 20px;border-top:1.5px solid var(--border);flex-direction:column;gap:12px}
.card.open .card-body{display:flex}
textarea,input[type=text],select{width:100%;background:var(--bg);border:1.5px solid var(--border);border-radius:var(--radius-sm);padding:11px 14px;font-family:'Space Mono',monospace;font-size:12px;color:var(--text);resize:vertical;outline:none;line-height:1.65;transition:border-color .2s,box-shadow .2s}
textarea:focus,input:focus,select:focus{border-color:var(--red);box-shadow:0 0 0 3px rgba(230,59,30,.1);background:var(--white)}
select{resize:none;cursor:pointer;background:var(--white)}
.row{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
.btn{display:inline-flex;align-items:center;gap:6px;font-family:'Space Mono',monospace;font-size:11px;font-weight:700;letter-spacing:.04em;padding:9px 18px;border-radius:var(--radius-sm);border:1.5px solid transparent;cursor:pointer;transition:all .18s;white-space:nowrap}
.btn-red{background:var(--red);color:#fff;border-color:var(--red-dark)}
.btn-red:hover{background:var(--red-dark);transform:translateY(-1px)}
.btn-ghost{background:var(--white);color:var(--text);border-color:var(--border)}
.btn-ghost:hover{background:var(--bg);border-color:var(--border2)}
.pills{display:flex;gap:6px;flex-wrap:wrap}
.pill{font-family:'Space Mono',monospace;font-size:10px;letter-spacing:.04em;padding:5px 12px;border-radius:100px;border:1.5px solid var(--border);background:var(--white);cursor:pointer;transition:all .15s;color:var(--text)}
.pill:hover,.pill.on{background:var(--text);color:#fff;border-color:var(--text)}
.lbl{font-family:'Space Mono',monospace;font-size:9px;letter-spacing:.1em;text-transform:uppercase;color:var(--muted)}
.status{font-family:'Space Mono',monospace;font-size:11px;color:var(--muted);min-height:16px;display:flex;align-items:center;gap:5px}
.ok{color:var(--green)}.er{color:var(--red)}
.out-wrap{position:relative}
.out-box{background:var(--code-bg);color:var(--code-text);border-radius:var(--radius-sm);padding:14px 16px;font-family:'Space Mono',monospace;font-size:11.5px;line-height:1.7;min-height:72px;word-break:break-all;white-space:pre-wrap;border:1.5px solid #2a2920}
.out-box .ph{color:#4a4840;font-style:italic}
.copy-btn{position:absolute;top:8px;right:8px;background:rgba(255,255,255,.08);border:1px solid rgba(255,255,255,.12);border-radius:6px;color:#888;font-family:'Space Mono',monospace;font-size:10px;padding:3px 10px;cursor:pointer;transition:all .2s}
.copy-btn:hover{background:rgba(255,255,255,.18);color:#fff}
.uuid-list{display:flex;flex-direction:column;gap:6px}
.uuid-row{background:var(--code-bg);color:#7dd3fc;border-radius:var(--radius-sm);padding:9px 14px;font-family:'Space Mono',monospace;font-size:11px;display:flex;justify-content:space-between;align-items:center;gap:10px;border:1.5px solid #2a2920}
.uuid-row button{background:none;border:none;color:#6b7280;cursor:pointer;font-size:14px;padding:2px 6px;border-radius:4px;transition:color .2s}
.uuid-row button:hover{color:#fff}
.divider{display:flex;align-items:center;gap:10px;font-family:'Space Mono',monospace;font-size:9px;letter-spacing:.1em;text-transform:uppercase;color:var(--muted)}
.divider::before,.divider::after{content:'';flex:1;height:1px;background:var(--border)}
.toast{position:fixed;bottom:20px;right:20px;background:var(--text);color:#fff;padding:11px 20px;border-radius:var(--radius-sm);font-family:'Space Mono',monospace;font-size:11px;z-index:9999;transform:translateY(60px) scale(.95);opacity:0;transition:all .3s cubic-bezier(.34,1.56,.64,1);box-shadow:0 8px 24px rgba(0,0,0,.2)}
.toast.show{transform:translateY(0) scale(1);opacity:1}
footer{position:relative;z-index:5;text-align:center;padding:24px;font-family:'Space Mono',monospace;font-size:10px;letter-spacing:.04em;color:var(--muted);border-top:1.5px solid var(--border)}
.mc-tag{display:inline-flex;align-items:center;gap:6px;background:var(--white);border:1.5px solid var(--border);border-radius:6px;padding:3px 10px;margin-bottom:8px}
.mc-dot{width:6px;height:6px;background:var(--green);border-radius:1px}
@keyframes fadeD{from{opacity:0;transform:translateY(-12px)}to{opacity:1;transform:translateY(0)}}
@keyframes fadeU{from{opacity:0;transform:translateY(16px)}to{opacity:1;transform:translateY(0)}}
@media(max-width:600px){.card-body{padding:14px}.row{flex-direction:column;align-items:stretch}.btn{width:100%;justify-content:center}}
</style>
</head>
<body>
<header>
  <div class="badge"><span class="blink"></span>MC BEDROCK &middot; QUICKJS V2 &middot; MULTI TOOLS</div>
  <h1>MULTI<br><em>TOOLS</em></h1>
  <p class="tagline" id="tagline">Универсальный набор разработчика &middot; Minecraft Bedrock Edition</p>
  <div class="lang-row">
    <button class="lang-btn on" onclick="setLang('ru')">RU</button>
    <button class="lang-btn" onclick="setLang('en')">EN</button>
  </div>
</header>
<nav class="nav-bar" id="nav-bar">
  <a class="nav-pill" href="#card-jtu">JSON&rarr;UNI</a>
  <a class="nav-pill" href="#card-utj">UNI&rarr;JSON</a>
  <a class="nav-pill" href="#card-obf">ОБФУСКАЦИЯ</a>
  <a class="nav-pill" href="#card-dob">ДЕОБФУСКАЦИЯ</a>
  <a class="nav-pill" href="#card-min">МИНИФИКАЦИЯ</a>
  <a class="nav-pill" href="#card-fmt">ФОРМАТИРОВАНИЕ</a>
  <a class="nav-pill" href="#card-uuid">UUID GEN</a>
</nav>
<main>
<div class="card" id="card-jtu">
  <div class="card-head" onclick="toggle('card-jtu')">
    <div class="icon-box" style="background:#fff2f0">&#128292;</div>
    <div class="card-meta">
      <div class="card-name" data-ru="JSON → UNICODE" data-en="JSON → UNICODE">JSON → UNICODE</div>
      <div class="card-sub" data-ru="Кириллицу и спецсимволы → \uXXXX" data-en="Cyrillic and special chars → \uXXXX">Кириллицу и спецсимволы → \uXXXX</div>
    </div>
    <span class="chevron">&#8964;</span>
  </div>
  <div class="card-body"><textarea id="jtu-in" rows="5" placeholder='{"text": "Привет, мир!"}'></textarea>
    <div class="pills">
      <span class="pill on" data-g="jtu-mode" onclick="setPill(this,'jtu-mode')">Все non-ASCII</span>
      <span class="pill" data-g="jtu-mode" onclick="setPill(this,'jtu-mode')">Только кириллица</span>
    </div>
    <div class="row">
      <button class="btn btn-red" onclick="jsonToUnicode()">&#9654; КОНВЕРТИРОВАТЬ</button>
      <button class="btn btn-ghost" onclick="clearCard('jtu')">&#10005; Очистить</button>
    </div>
    <div class="status" id="jtu-st"></div><div class="lbl">ВЫВОД</div>
    <div class="out-wrap">
      <div class="out-box" id="jtu-out"><span class="ph">Результат появится здесь...</span></div>
      <button class="copy-btn" onclick="copyBox('jtu-out')">COPY</button>
    </div></div>
</div>
<div class="card" id="card-utj">
  <div class="card-head" onclick="toggle('card-utj')">
    <div class="icon-box" style="background:#fffbeb">&#128260;</div>
    <div class="card-meta">
      <div class="card-name" data-ru="UNICODE → JSON" data-en="UNICODE → JSON">UNICODE → JSON</div>
      <div class="card-sub" data-ru="Декодировать \uXXXX обратно в текст" data-en="Decode \uXXXX back to readable text">Декодировать \uXXXX обратно в текст</div>
    </div>
    <span class="chevron">&#8964;</span>
  </div>
  <div class="card-body"><textarea id="utj-in" rows="5" placeholder='{"text": "\u041f\u0440\u0438\u0432\u0435\u0442"}'></textarea>
    <div class="row">
      <button class="btn btn-red" onclick="unicodeToJson()">&#9654; ДЕКОДИРОВАТЬ</button>
      <button class="btn btn-ghost" onclick="clearCard('utj')">&#10005; Очистить</button>
    </div>
    <div class="status" id="utj-st"></div><div class="lbl">ВЫВОД</div>
    <div class="out-wrap">
      <div class="out-box" id="utj-out"><span class="ph">Результат появится здесь...</span></div>
      <button class="copy-btn" onclick="copyBox('utj-out')">COPY</button>
    </div></div>
</div>
<div class="card" id="card-obf">
  <div class="card-head" onclick="toggle('card-obf')">
    <div class="icon-box" style="background:#f8fafc">&#128274;</div>
    <div class="card-meta">
      <div class="card-name" data-ru="ОБФУСКАЦИЯ КОДА" data-en="CODE OBFUSCATION">ОБФУСКАЦИЯ КОДА</div>
      <div class="card-sub" data-ru="Защитить JS · совместимо с QuickJS v2" data-en="Protect JS · QuickJS v2 compatible">Защитить JS · совместимо с QuickJS v2</div>
    </div>
    <span class="chevron">&#8964;</span>
  </div>
  <div class="card-body"><textarea id="obf-in" rows="6" placeholder="// JS код для Minecraft аддона"></textarea>
    <div class="pills">
      <span class="pill on" data-g="obf-level" onclick="setPill(this,'obf-level')">Лёгкая</span>
      <span class="pill" data-g="obf-level" onclick="setPill(this,'obf-level')">Средняя</span>
      <span class="pill" data-g="obf-level" onclick="setPill(this,'obf-level')">Сильная</span>
    </div>
    <div class="row">
      <button class="btn btn-red" onclick="obfuscate()">&#9654; ОБФУСЦИРОВАТЬ</button>
      <button class="btn btn-ghost" onclick="clearCard('obf')">&#10005; Очистить</button>
    </div>
    <div class="status" id="obf-st"></div><div class="lbl">РЕЗУЛЬТАТ</div>
    <div class="out-wrap">
      <div class="out-box" id="obf-out"><span class="ph">Результат появится здесь...</span></div>
      <button class="copy-btn" onclick="copyBox('obf-out')">COPY</button>
    </div></div>
</div>
<div class="card" id="card-dob">
  <div class="card-head" onclick="toggle('card-dob')">
    <div class="icon-box" style="background:#f0fdf6">&#128275;</div>
    <div class="card-meta">
      <div class="card-name" data-ru="ДЕОБФУСКАЦИЯ КОДА" data-en="CODE DEOBFUSCATION">ДЕОБФУСКАЦИЯ КОДА</div>
      <div class="card-sub" data-ru="Восстановить читаемый вид кода" data-en="Restore readable code form">Восстановить читаемый вид кода</div>
    </div>
    <span class="chevron">&#8964;</span>
  </div>
  <div class="card-body"><textarea id="dob-in" rows="6" placeholder="// Вставьте обфусцированный JS код..."></textarea>
    <div class="row">
      <button class="btn btn-red" onclick="deobfuscate()">&#9654; ДЕОБФУСЦИРОВАТЬ</button>
      <button class="btn btn-ghost" onclick="clearCard('dob')">&#10005; Очистить</button>
    </div>
    <div class="status" id="dob-st"></div><div class="lbl">РЕЗУЛЬТАТ</div>
    <div class="out-wrap">
      <div class="out-box" id="dob-out"><span class="ph">Результат появится здесь...</span></div>
      <button class="copy-btn" onclick="copyBox('dob-out')">COPY</button>
    </div></div>
</div>
<div class="card" id="card-min">
  <div class="card-head" onclick="toggle('card-min')">
    <div class="icon-box" style="background:#eff6ff">&#9889;</div>
    <div class="card-meta">
      <div class="card-name" data-ru="МИНИФИКАЦИЯ КОДА" data-en="CODE MINIFICATION">МИНИФИКАЦИЯ КОДА</div>
      <div class="card-sub" data-ru="Уменьшить размер JS / JSON файлов" data-en="Reduce file size of JS / JSON">Уменьшить размер JS / JSON файлов</div>
    </div>
    <span class="chevron">&#8964;</span>
  </div>
  <div class="card-body"><div class="pills">
      <span class="pill on" data-g="min-type" onclick="setPill(this,'min-type')">JavaScript</span>
      <span class="pill" data-g="min-type" onclick="setPill(this,'min-type')">JSON</span>
    </div>
    <textarea id="min-in" rows="6" placeholder="// Вставьте код для минификации..."></textarea>
    <div class="row">
      <button class="btn btn-red" onclick="minify()">&#9654; МИНИФИЦИРОВАТЬ</button>
      <button class="btn btn-ghost" onclick="clearCard('min')">&#10005; Очистить</button>
    </div>
    <div class="status" id="min-st"></div><div class="lbl">РЕЗУЛЬТАТ</div>
    <div class="out-wrap">
      <div class="out-box" id="min-out"><span class="ph">Результат появится здесь...</span></div>
      <button class="copy-btn" onclick="copyBox('min-out')">COPY</button>
    </div></div>
</div>
<div class="card" id="card-fmt">
  <div class="card-head" onclick="toggle('card-fmt')">
    <div class="icon-box" style="background:#faf5ff">&#10022;</div>
    <div class="card-meta">
      <div class="card-name" data-ru="ФОРМАТИРОВАНИЕ КОДА" data-en="CODE FORMATTING">ФОРМАТИРОВАНИЕ КОДА</div>
      <div class="card-sub" data-ru="Красиво отформатировать JS / JSON" data-en="Prettify JS / JSON code">Красиво отформатировать JS / JSON</div>
    </div>
    <span class="chevron">&#8964;</span>
  </div>
  <div class="card-body"><div class="pills">
      <span class="pill on" data-g="fmt-type" onclick="setPill(this,'fmt-type')">JSON</span>
      <span class="pill" data-g="fmt-type" onclick="setPill(this,'fmt-type')">JavaScript</span>
    </div>
    <textarea id="fmt-in" rows="6" placeholder='{"a":1,"b":[1,2,3]}'></textarea>
    <div class="row">
      <span class="lbl" style="align-self:center">ОТСТУП</span>
      <select id="fmt-indent" style="width:auto;flex:0">
        <option value="2">2 пробела</option>
        <option value="4">4 пробела</option>
        <option value="TAB">Tab</option>
      </select>
      <button class="btn btn-red" onclick="formatCode()">&#9654; ФОРМАТИРОВАТЬ</button>
      <button class="btn btn-ghost" onclick="clearCard('fmt')">&#10005;</button>
    </div>
    <div class="status" id="fmt-st"></div><div class="lbl">РЕЗУЛЬТАТ</div>
    <div class="out-wrap">
      <div class="out-box" id="fmt-out"><span class="ph">Результат появится здесь...</span></div>
      <button class="copy-btn" onclick="copyBox('fmt-out')">COPY</button>
    </div></div>
</div>
<div class="card" id="card-uuid">
  <div class="card-head" onclick="toggle('card-uuid')">
    <div class="icon-box" style="background:#fff1f2">&#127922;</div>
    <div class="card-meta">
      <div class="card-name" data-ru="UUID ГЕНЕРАТОР" data-en="UUID GENERATOR">UUID ГЕНЕРАТОР</div>
      <div class="card-sub" data-ru="UUID v4 для manifest.json Minecraft аддонов" data-en="UUID v4 for Minecraft addon manifest.json">UUID v4 для manifest.json Minecraft аддонов</div>
    </div>
    <span class="chevron">&#8964;</span>
  </div>
  <div class="card-body"><div class="row">
      <span class="lbl" style="align-self:center">КОЛ-ВО</span>
      <select id="uuid-count" style="width:auto;flex:0">
        <option>1</option><option selected>2</option><option>4</option><option>8</option>
      </select>
      <button class="btn btn-red" onclick="genUUIDs()">&#9654; ГЕНЕРИРОВАТЬ</button>
      <button class="btn btn-ghost" onclick="copyAllUUIDs()">&#8856; ВСЕ</button>
    </div>
    <div class="uuid-list" id="uuid-list"><div class="status">Нажмите «Генерировать»...</div></div>
    <div class="divider">MANIFEST.JSON ШАБЛОН</div>
    <div class="out-wrap">
      <div class="out-box" style="min-height:180px" id="uuid-manifest"><span class="ph">Сначала сгенерируйте UUID...</span></div>
      <button class="copy-btn" onclick="copyBox('uuid-manifest')">COPY</button>
    </div></div>
</div>
</main>
<footer>
  <div><span class="mc-tag"><span class="mc-dot"></span>Minecraft Bedrock &middot; QuickJS v2</span></div>
  Multi Tools &mdash; Набор разработчика аддонов
</footer>
<div class="toast" id="toast"></div>
<script>

var S = {lang:'ru'};
var pillState = {};
var uuidStore = [];

function setLang(l) {
  S.lang = l;
  document.querySelectorAll('.lang-btn').forEach(function(b){
    b.classList.toggle('on', b.textContent === l.toUpperCase());
  });
  document.getElementById('tagline').textContent = l === 'ru'
    ? 'Универсальный набор разработчика · Minecraft Bedrock Edition'
    : 'Universal Developer Toolkit · Minecraft Bedrock Edition';
  document.querySelectorAll('[data-ru]').forEach(function(el){
    el.textContent = el.dataset[l];
  });
  var navRU = ['JSON→UNI','UNI→JSON','ОБФУСКАЦИЯ','ДЕОБФУСКАЦИЯ','МИНИФИКАЦИЯ','ФОРМАТИРОВАНИЕ','UUID GEN'];
  var navEN = ['JSON→UNI','UNI→JSON','OBFUSCATE','DEOBFUSCATE','MINIFY','FORMAT','UUID GEN'];
  document.querySelectorAll('.nav-pill').forEach(function(p,i){
    p.textContent = (l==='ru' ? navRU : navEN)[i];
  });
}

function toggle(id) {
  document.getElementById(id).classList.toggle('open');
}

function setPill(el, group) {
  el.closest('.pills').querySelectorAll('.pill').forEach(function(p){ p.classList.remove('on'); });
  el.classList.add('on');
  pillState[group] = Array.from(el.closest('.pills').querySelectorAll('.pill')).indexOf(el);
}

function getPill(group) {
  return pillState[group] || 0;
}

function toast(msg) {
  var t = document.getElementById('toast');
  t.textContent = msg;
  t.classList.add('show');
  clearTimeout(t._tid);
  t._tid = setTimeout(function(){ t.classList.remove('show'); }, 2000);
}

function showStatus(id, ok, msg) {
  var el = document.getElementById(id + '-st');
  if (!el) return;
  el.innerHTML = ok
    ? '<span class="ok">✓</span>&nbsp;' + msg
    : '<span class="er">✕</span>&nbsp;' + msg;
}

function setOut(id, text) {
  var box = document.getElementById(id + '-out');
  box.innerHTML = '';
  box.appendChild(document.createTextNode(text));
  var btn = document.createElement('button');
  btn.className = 'copy-btn';
  btn.textContent = 'COPY';
  (function(t){ btn.onclick = function(){ copyText(t); }; })(text);
  box.appendChild(btn);
}

function copyText(text) {
  navigator.clipboard.writeText(text)
    .then(function(){
      toast(S.lang === 'ru' ? '✓ Скопировано!' : '✓ Copied!');
    })
    .catch(function(){});
}

function copyBox(boxId) {
  var box = document.getElementById(boxId);
  var text = '';
  box.childNodes.forEach(function(n){
    if (n.nodeType === 3) text += n.textContent;
  });
  copyText(text.trim() || (box.innerText||'').replace('COPY','').trim());
}

function clearCard(id) {
  var inp = document.getElementById(id + '-in');
  if (inp) inp.value = '';
  var out = document.getElementById(id + '-out');
  if (out) {
    out.innerHTML = '<span class="ph">Результат появится здесь...</span>';
    var btn = document.createElement('button');
    btn.className = 'copy-btn';
    btn.textContent = 'COPY';
    (function(bid){ btn.onclick = function(){ copyBox(bid); }; })(id + '-out');
    out.appendChild(btn);
  }
  var s = document.getElementById(id + '-st');
  if (s) s.innerHTML = '';
}

/* ═══ 1. JSON to UNICODE ═══
   Iterate char by char using charCodeAt - no regex unicode range needed */
function jsonToUnicode() {
  var inp = document.getElementById('jtu-in').value;
  if (!inp.trim()) { showStatus('jtu', false, 'Введите текст или JSON'); return; }
  try {
    var mode = getPill('jtu-mode');
    var result = '';
    var count = 0;
    for (var i = 0; i < inp.length; i++) {
      var code = inp.charCodeAt(i);
      var escape = mode === 1
        ? (code >= 1024 && code <= 1279)   /* cyrillic block */
        : (code > 127);                     /* all non-ASCII */
      if (escape) {
        var hex = code.toString(16);
        while (hex.length < 4) hex = '0' + hex;
        result += '\x5cu' + hex;
        count++;
      } else {
        result += inp.charAt(i);
      }
    }
    setOut('jtu', result);
    showStatus('jtu', true, 'Заменено: ' + count + ' · ' + inp.length + ' → ' + result.length + ' знаков');
  } catch(e) { showStatus('jtu', false, e.message); }
}

/* ═══ 2. UNICODE to JSON ═══ */
function unicodeToJson() {
  var inp = document.getElementById('utj-in').value;
  if (!inp.trim()) { showStatus('utj', false, 'Введите строку с \x5cuXXXX'); return; }
  try {
    var result = inp.replace(/\\u([0-9a-fA-F]{4})/g, function(_, h) {
      return String.fromCharCode(parseInt(h, 16));
    });
    setOut('utj', result);
    showStatus('utj', true, inp.length + ' → ' + result.length + ' символов');
  } catch(e) { showStatus('utj', false, e.message); }
}

/* ═══ 3. OBFUSCATION ═══ */
function stripComments(c) {
  return c.replace(/\/\/[^\n]*/g, '').replace(/\/\*[\s\S]*?\*\//g, '').trim();
}

function obfLight(code) {
  var c = stripComments(code);
  var map = {}; var n = 0;
  function gen() {
    var s = '_$', x = n++;
    do { s += String.fromCharCode(97 + x % 26); x = Math.floor(x / 26); } while (x > 0);
    return s;
  }
  var defs = [];
  c.replace(/\b(?:let|const|var|function)\s+([a-zA-Z_$][a-zA-Z0-9_$]*)/g, function(_, nm) {
    if (defs.indexOf(nm) < 0) defs.push(nm);
  });
  defs.forEach(function(nm) { if (!map[nm]) map[nm] = gen(); });
  defs.forEach(function(nm) {
    var re = new RegExp('\\b' + nm + '\\b', 'g');
    c = c.replace(re, map[nm]);
  });
  return c.replace(/[ \t]{2,}/g, ' ').replace(/\n\s*\n/g, '\n');
}

function obfMedium(code) {
  var c = obfLight(code);
  c = c.replace(/('(?:[^'\\]|\\.)*'|"(?:[^"\\]|\\.)*")/g, function(m) {
    var q = m[0], inner = m.slice(1, -1);
    var hex = inner.split('').map(function(ch) {
      var h = ch.charCodeAt(0).toString(16);
      while (h.length < 2) h = '0' + h;
      return '\\x' + h;
    }).join('');
    return q + hex + q;
  });
  return c.replace(/\s*([{}();,=+\-*\/<>!&|?:\[\]])\s*/g, '$1').replace(/\s+/g, ' ').trim();
}

function obfHeavy(code) {
  var med = obfMedium(code);
  var b64 = btoa(unescape(encodeURIComponent(med)));
  return 'eval(decodeURIComponent(escape(atob("' + b64 + '"))))';
}

function obfuscate() {
  var code = document.getElementById('obf-in').value.trim();
  if (!code) { showStatus('obf', false, 'Введите JS код'); return; }
  try {
    var lvl = getPill('obf-level');
    var result = lvl === 0 ? obfLight(code) : lvl === 1 ? obfMedium(code) : obfHeavy(code);
    var names = ['Лёгкая', 'Средняя', 'Сильная'];
    setOut('obf', result);
    showStatus('obf', true, 'Уровень: ' + names[lvl] + ' · ' + code.length + ' → ' + result.length + ' байт');
  } catch(e) { showStatus('obf', false, e.message); }
}

/* ═══ 4. DEOBFUSCATION ═══ */
function jsBeautify(code) {
  var depth = 0, out = '', i = 0;
  function ind() { var s = ''; for (var k = 0; k < Math.max(0, depth); k++) s += '  '; return s; }
  while (i < code.length) {
    var ch = code[i];
    if (ch === '{') { out += ch + '\n'; depth++; out += ind(); }
    else if (ch === '}') { depth = Math.max(0, depth - 1); out = out.trimEnd() + '\n' + ind() + ch; }
    else if (ch === ';') { out += ch + '\n' + ind(); }
    else { out += ch; }
    i++;
  }
  return out.replace(/\n\s*\n/g, '\n').trim();
}

function deobfuscate() {
  var code = document.getElementById('dob-in').value.trim();
  if (!code) { showStatus('dob', false, 'Введите обфусцированный код'); return; }
  try {
    var r = code;
    var m1 = r.match(/eval\(decodeURIComponent\(escape\(atob\("([^"]+)"\)\)\)\)/);
    if (m1) r = decodeURIComponent(escape(atob(m1[1])));
    r = r.replace(/\\x([0-9a-fA-F]{2})/g, function(_, h) { return String.fromCharCode(parseInt(h, 16)); });
    r = r.replace(/\\u([0-9a-fA-F]{4})/g, function(_, h) { return String.fromCharCode(parseInt(h, 16)); });
    r = jsBeautify(r);
    setOut('dob', r);
    showStatus('dob', true, 'Деобфусцировано (частично)');
  } catch(e) { showStatus('dob', false, 'Ошибка: ' + e.message); }
}

/* ═══ 5. MINIFY ═══ */
function minify() {
  var code = document.getElementById('min-in').value.trim();
  if (!code) { showStatus('min', false, 'Введите код'); return; }
  try {
    var result;
    if (getPill('min-type') === 1) {
      result = JSON.stringify(JSON.parse(code));
    } else {
      result = code
        .replace(/\/\/[^\n]*/g, '')
        .replace(/\/\*[\s\S]*?\*\//g, '')
        .replace(/\s*([{}();,=+\-*\/<>!&|?:\[\]])\s*/g, '$1')
        .replace(/\s+/g, ' ').trim();
    }
    var pct = (100 * (1 - result.length / code.length)).toFixed(1);
    setOut('min', result);
    showStatus('min', true, code.length + ' → ' + result.length + ' байт · −' + pct + '%');
  } catch(e) { showStatus('min', false, e.message); }
}

/* ═══ 6. FORMAT ═══ */
function formatCode() {
  var code = document.getElementById('fmt-in').value.trim();
  if (!code) { showStatus('fmt', false, 'Введите код'); return; }
  var indVal = document.getElementById('fmt-indent').value;
  var ind = indVal === 'TAB' ? '\t' : new Array(parseInt(indVal) + 1).join(' ');
  try {
    var result;
    if (getPill('fmt-type') === 0) {
      result = JSON.stringify(JSON.parse(code), null, ind);
    } else {
      result = jsBeautify(code);
    }
    setOut('fmt', result);
    showStatus('fmt', true, 'Отформатировано · ' + result.split('\n').length + ' строк');
  } catch(e) { showStatus('fmt', false, e.message); }
}

/* ═══ 7. UUID ═══ */
function uuidv4() {
  return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
    var r = crypto.getRandomValues(new Uint8Array(1))[0] & 15;
    return (c === 'x' ? r : (r & 0x3 | 0x8)).toString(16);
  });
}

function genUUIDs() {
  var count = parseInt(document.getElementById('uuid-count').value);
  uuidStore = [];
  for (var i = 0; i < count; i++) uuidStore.push(uuidv4());
  var list = document.getElementById('uuid-list');
  list.innerHTML = '';
  uuidStore.forEach(function(u) {
    var row = document.createElement('div');
    row.className = 'uuid-row';
    var span = document.createElement('span');
    span.textContent = u;
    var btn = document.createElement('button');
    btn.textContent = '⦻';
    btn.title = 'Copy';
    (function(uuid){ btn.onclick = function(){ copyText(uuid); }; })(u);
    row.appendChild(span);
    row.appendChild(btn);
    list.appendChild(row);
  });
  var h = uuidStore[0];
  var m = uuidStore[1] || uuidv4();
  var manifest = JSON.stringify({
    format_version: 2,
    header: { description: 'My Addon', name: 'My Addon', uuid: h, version: [1,0,0], min_engine_version: [1,20,0] },
    modules: [{ description: 'Behaviour Pack', type: 'data', uuid: m, version: [1,0,0] }]
  }, null, 2);
  var box = document.getElementById('uuid-manifest');
  box.innerHTML = '';
  box.appendChild(document.createTextNode(manifest));
  var btn2 = document.createElement('button');
  btn2.className = 'copy-btn';
  btn2.textContent = 'COPY';
  (function(t){ btn2.onclick = function(){ copyText(t); }; })(manifest);
  box.appendChild(btn2);
  toast('✓ ' + count + ' UUID сгенерировано');
}

function copyAllUUIDs() {
  if (!uuidStore.length) { toast('Сначала генерируйте UUID'); return; }
  copyText(uuidStore.join('\n'));
}

document.getElementById('card-jtu').classList.add('open');

</script>
</body>
</html>
